// main global script file


// VARIABLES PANEL DIGITAL GLOBALES
 int panelDigito1 = -1;
 int panelDigito2 = -1;
 int panelDigito3 = -1;
 int panelDigito4 = -1;
 int panelPos = 1;
  bool panelActivo = false;
  bool bPanelResuelto = false;



// CÓDIGO CORRECTO DEL PANEL
 int codigoDigito1 = 4;
 int codigoDigito2 = 7;
 int codigoDigito3 = 4;
 int codigoDigito4 = 2;
  
 //Para el panel de la ROOM2
  String numeros[10]; 
  
// called when the game starts, before the first room is loaded
function game_start()
{
  
 
  // Auto-save on the save slot 999
  SetRestartPoint();
  
  //EMPEZAMOS EN EL ROOM "Game Start"
  player.ChangeRoom(5);  
  
  //Usamos la fuente 3 que es la que tiene acentos,  obtenida gracias a TheMontyDrake
  Game.SpeechFont = eFontFont3;
  Game.NormalFont = eFontFont3;

  
  numeros[0] = "0";
  numeros[1] = "1";
  numeros[2] = "2";
  numeros[3] = "3";
  numeros[4] = "4";
  numeros[5] = "5";
  numeros[6] = "6";
  numeros[7] = "7";
  numeros[8] = "8";
  numeros[9] = "9";
  
}


  
// called on every game cycle, except when the game is blocked
function repeatedly_execute()
{
}

// called on every game cycle, even when the game is blocked
function repeatedly_execute_always()
{
}

// called when a key is pressed
function on_key_press(eKeyCode keycode, int mod)
{
  if (IsGamePaused())
  {
    // game paused, so don't react to any keypresses
    keycode = 0;
  }
  else if (keycode == eKeyQ && (mod & eKeyModCtrl))
  {
    // Ctrl-Q will quit the game
    QuitGame(1);
  }
  else if (keycode == eKeyF9)
  {
    // F9 will restart the game
    RestartGame();
  }
  else if (keycode == eKeyF12)
  {
    // F12 will save a screenshot to the save game folder
    SaveScreenShot("screenshot.pcx");
  }
  else if (mod & eKeyModCtrl)
  {
    if (keycode == eKeyS)
    {
      // Ctrl-S will give the player all defined inventory items
      Debug(0, 0);
    }
    else if (keycode == eKeyV)
    {
      // Ctrl-V will show game engine version and build date
      Debug(1, 0);
    }
    else if (keycode == eKeyA)
    {
      // Ctrl-A will show walkable areas
      Debug(2, 3);
    }
    else if (keycode == eKeyX)
    {
      // Ctrl-X will let the player teleport to any room
      Debug(3, 0);
    }
  }
}

// called when a mouse button is clicked
function on_mouse_click(MouseButton button)
{
  if (IsGamePaused())
  {
    // game is paused, so do nothing (i.e. don't process mouse clicks)
  }
  else if (button == eMouseLeft)
  {
    // left-click, so try using the current mouse cursor mode at this position
    Room.ProcessClick(mouse.x, mouse.y, mouse.Mode);
  }
  else if (button == eMouseRight)
  {
    // right-click, so cycle the mouse cursor mode
    mouse.SelectNextMode();
  }
}

function dialog_request(int param)
{

}

function Button4_OnClick(GUIControl *control, MouseButton button)
{

}

function Button1_OnClick(GUIControl *control, MouseButton button)
{

}

function Button2_OnClick(GUIControl *control, MouseButton button)
{

}

function Button11_OnClick(GUIControl *control, MouseButton button)
{

}

function Button7_OnClick(GUIControl *control, MouseButton button)
{

}

// ==========================
// BOTONES PANEL DIGITAL
// ==========================

//Actualizar el panel digital 


 function ActualizarPanelGUI()
{
if (panelDigito1 == -1)
    Lb1.Text = "-";
else
    Lb1.Text = numeros[panelDigito1];

if (panelDigito2 == -1)
    Lb2.Text = "-";
else
    Lb2.Text = numeros[panelDigito2];

if (panelDigito3 == -1)
    Lb3.Text = "-";
else
    Lb3.Text = numeros[panelDigito3];

if (panelDigito4 == -1)
    Lb4.Text = "-";
else
    Lb4.Text = numeros[panelDigito4];
}

 function Panel_AgregarDigito(int digito)
{
    if (panelPos == 1) panelDigito1 = digito;
    else if (panelPos == 2) panelDigito2 = digito;
    else if (panelPos == 3) panelDigito3 = digito;
    else if (panelPos == 4) panelDigito4 = digito;

    if (panelPos < 4) panelPos++;

    ActualizarPanelGUI();
}

function btnP0_OnClick() { Panel_AgregarDigito(0); }
function btnP1_OnClick() { Panel_AgregarDigito(1); }
function btnP2_OnClick() { Panel_AgregarDigito(2); }
function btnP3_OnClick() { Panel_AgregarDigito(3); }
function btnP4_OnClick() { Panel_AgregarDigito(4); }
function btnP5_OnClick() { Panel_AgregarDigito(5); }
function btnP6_OnClick() { Panel_AgregarDigito(6); }
function btnP7_OnClick() { Panel_AgregarDigito(7); }
function btnP8_OnClick() { Panel_AgregarDigito(8); }
function btnP9_OnClick() { Panel_AgregarDigito(9); }

function Panel_Borrar()
{
    panelDigito1 = -1;
    panelDigito2 = -1;
    panelDigito3 = -1;
    panelDigito4 = -1;
    panelPos = 1;
    ActualizarPanelGUI();
}

function Panel_Cancelar()
{
    Panel_Borrar();
    panelActivo = false;
    gPanelCodigo.Visible = false;
}

function Panel_Aceptar()
{   
    if (panelDigito1 == -1 || panelDigito2 == -1 ||
        panelDigito3 == -1 || panelDigito4 == -1)
    {
        cPaxton.Say("Vaya, se me olvdió meter los 4 dígitos");
        return;
    }
    if (panelDigito1 == 4 && panelDigito2 == 7 &&
        panelDigito3 == 4 && panelDigito4 == 2)
    {
        cPaxton.Say("¡Mira, la puerta se ha abierto!");
        bPanelResuelto = true;
        panelActivo = false;
        gPanelCodigo.Visible = false;
    }
    else
    {
        cPaxton.Say("Parece que la puerta sigue sin abrirse, prueba con otra combinación.");
        Panel_Borrar();
    }
}

function btnPBorrar_OnClick()
{
    Panel_Borrar();
}

function btnPAceptar_OnClick()
{
    Panel_Aceptar();
}

function btnPCancelar_OnClick()
{
    Panel_Cancelar();
}

// Exportar variables individualmente
export  panelActivo;
export  bPanelResuelto;
export  codigoDigito1;
export  codigoDigito2;
export  codigoDigito3;
export  codigoDigito4;
export ActualizarPanelGUI;
export Panel_AgregarDigito;

function TextBox1_OnActivate(GUIControl *control)
{

}

//BOTÓN BOLSO (al inventario)
function bBolso_OnClick(GUIControl *control, MouseButton button)
{
  if(gInv.Visible==false)gInv.Visible=true;
  else gInv.Visible=false;
}





//=====================================================================
//--------------------------ROOM 4------------------------
//PAPEL CON MENSAJE
function iPapelMensaje_Look(InventoryItem *theItem, CursorMode mode)
{
  cPaxton.Say("Pone 1 Nefi 3:7");
  gSabenComb = 1;
}


//______CAJA CANDADO__________
// --- Variables del candado
int candadoNum1 = 0;
int candadoNum2 = 0;
int candadoNum3 = 0;

// --- Combinación correcta 
int combinacion1 = 1;
int combinacion2 = 3;
int combinacion3 = 7;

// Función para comprobar si el candado se abre 
function ComprobarCandado() {
    if (candadoNum1 == combinacion1 && candadoNum2 == combinacion2 && candadoNum3 == combinacion3) {
        cPaxton.Say("¡El candado se ha abierto!");
        gCaja.Visible = false; // Oculta el GUI del candado
        //La caja se abre
        object[11].Visible = false; // caja cerrada
        object[12].Visible = true;  // caja abierta
    }
}

//BOTÓN 1
function bot1_OnClick(GUIControl *control, MouseButton button)
{
  candadoNum1++;
    if (candadoNum1 > 9) candadoNum1 = 0;
    bot1.Text = String.Format("%d", candadoNum1);
    ComprobarCandado();
}
//BOTÓN 2
function bot2_OnClick(GUIControl *control, MouseButton button)
{
  candadoNum2++;
    if (candadoNum2 > 9) candadoNum2 = 0;
    bot2.Text = String.Format("%d", candadoNum2);
    ComprobarCandado();
}
//BOTÓN 3
function bot3_OnClick(GUIControl *control, MouseButton button)
{
  candadoNum3++;
    if (candadoNum3 > 9) candadoNum3 = 0;
    bot3.Text = String.Format("%d", candadoNum3);
    ComprobarCandado();
}


//HABLAR CON BARNES
function cBarnes_Talk(Character *theCharacter, CursorMode mode)
{
  if(player.Room == 1){
    dBarnes1.Start();
  }else if(player.Room == 4 && gPapel==1){
    dBarnes4.Start();
  }

}
function gInv_OnClick(GUI *theGui, MouseButton button)
{

}
