
// ROOM 2 


// ESTADOS INICIALES
bool bAbrigosCogidos = false;
bool bTijerasCogidas = false;
bool bViniloCogido = false;
bool bViniloColocado = false; 
bool bDiscoEscuchado = false;
bool bPanelResuelto = false;

// Pistas cuadros
bool bCuadro1Examinado = false;
bool bCuadro2Examinado = false;
bool bCuadro3Examinado = false;
bool bCuadro4Examinado = false;

// Pistas libros
bool bLibro1Examinado = false;
bool bLibro2Examinado = false;
bool bLibro3Examinado = false;
bool bLibro4Examinado = false;

// Código del panel
int codigoDigito1 = 0;
int codigoDigito2 = 0;
int codigoDigito3 = 0;
int codigoDigito4 = 0;
String codigoIngresado;


// VARIABLES PANEL DIGITAL
int panelDigito1 = -1;
int panelDigito2 = -1;
int panelDigito3 = -1;
int panelDigito4 = -1;
int panelPos = 1;
bool panelActivo = false;


// PRIMERA VEZ EN ROOM
bool primeraVezRoom2 = true;
String numeros[10];


//Actualizar el panel digital 


function ActualizarPanelGUI()
{
if (panelDigito1 == -1)
    Lb1.Text = "-";
else
    Lb1.Text = numeros[panelDigito1];

if (panelDigito2 == -1)
    Lb2.Text = "-";
else
    Lb2.Text = numeros[panelDigito2];

if (panelDigito3 == -1)
    Lb3.Text = "-";
else
    Lb3.Text = numeros[panelDigito3];

if (panelDigito4 == -1)
    Lb4.Text = "-";
else
    Lb4.Text = numeros[panelDigito4];
}

// ROOM LOAD
function room_Load()
{
    codigoIngresado = "";
    numeros[0] = "0";
    numeros[1] = "1";
    numeros[2] = "2";
    numeros[3] = "3";
    numeros[4] = "4";
    numeros[5] = "5";
    numeros[6] = "6";
    numeros[7] = "7";
    numeros[8] = "8";
    numeros[9] = "9";
    cPaxton.x = 320;
    cPaxton.y = 300;

    cBarnes.x = 280;
    cBarnes.y = 300;
    cBarnes.LockView(2);

    // Visibilidad inicial
    oTocadiscosSin.Visible = true;
    oTocadiscosCon.Visible = false;
    
    // Inicializar labels del panel
    ActualizarPanelGUI();
}

// ==========================
// VERIFICAR PISTAS
// ==========================
function VerificarPistas()
{
    if (bCuadro1Examinado && bCuadro2Examinado &&
        bCuadro3Examinado && bCuadro4Examinado &&
        bLibro1Examinado && bLibro2Examinado && bLibro3Examinado && bLibro4Examinado)
    {
        Display("Creo que ya lo tengo...");
        Display("Código: 4 - 7 - 4 - 2");
    }
}

// ==========================
// FUNCIONES PANEL DIGITAL

    
function Panel_AgregarDigito(int digito)
{
    if (panelPos == 1) { panelDigito1 = digito; panelPos = 2; }
    else if (panelPos == 2) { panelDigito2 = digito; panelPos = 3; }
    else if (panelPos == 3) { panelDigito3 = digito; panelPos = 4; }
    else if (panelPos == 4) { panelDigito4 = digito; panelPos = 4; }

    ActualizarPanelGUI();
}

function btnPBorrar_OnClick()
{
    panelDigito1 = -1;
    panelDigito2 = -1;
    panelDigito3 = -1;
    panelDigito4 = -1;
    panelPos = 1;
    ActualizarPanelGUI();
}

function btnPCancelar_OnClick()
{
    panelDigito1 = -1;
    panelDigito2 = -1;
    panelDigito3 = -1;
    panelDigito4 = -1;
    panelPos = 1;
    panelActivo = false;
    gPanelCodigo.Visible=false;
    ActualizarPanelGUI();
    cPaxton.Say("He salido del panel digital.");
}

function btnPAceptar_OnClick()
{
    if (panelDigito1 == -1 || panelDigito2 == -1 || panelDigito3 == -1 || panelDigito4 == -1)
    {
        cPaxton.Say("Debes ingresar los 4 dígitos primero.");
        return;
    }

    if (panelDigito1 == 4 && panelDigito2 == 7 && panelDigito3 == 4 && panelDigito4 == 2)
    {
        cPaxton.Say("¡Código correcto!");
        bPanelResuelto = true;
        panelActivo = false;
        gPanelCodigo.Visible=false;
    }
    else
    {
        cPaxton.Say("Código incorrecto.");
        panelDigito1 = -1;
        panelDigito2 = -1;
        panelDigito3 = -1;
        panelDigito4 = -1;
        panelPos = 1;
        ActualizarPanelGUI();
    }
}

// Botones DEL PANEL
function btnP0_OnClick() { Panel_AgregarDigito(0); }
function btnP1_OnClick() { Panel_AgregarDigito(1); }
function btnP2_OnClick() { Panel_AgregarDigito(2); }
function btnP3_OnClick() { Panel_AgregarDigito(3); }
function btnP4_OnClick() { Panel_AgregarDigito(4); }
function btnP5_OnClick() { Panel_AgregarDigito(5); }
function btnP6_OnClick() { Panel_AgregarDigito(6); }
function btnP7_OnClick() { Panel_AgregarDigito(7); }
function btnP8_OnClick() { Panel_AgregarDigito(8); }
function btnP9_OnClick() { Panel_AgregarDigito(9); }

// ==========================
// HOTSPOT PANEL DIGITAL
// ==========================
function hPanel_Interact()
{
    panelActivo = true;
    gPanelCodigo.Visible=true;
    ActualizarPanelGUI();
    cPaxton.Say("Necesito ingresar el código de 4 dígitos.");
}
function hPanel_MouseMove() { Display("Panel digital"); }

function hPanel_LookAt()
{
    cBarnes.Say("Parece que está conectado a la puerta");
}

// ==========================
// ABRIGOS
// ==========================

function hAbrigoPaxton_LookAt()
{
    cBarnes.Say("¡Mira!, son nuestros abrigos");
}

function hAbrigoBarnes_LookAt()
{
    cBarnes.Say("¡Mira!, son nuestros abrigos");
}

function hAbrigoPaxton_Interact()
{
    if (!bAbrigosCogidos)
    {
        bAbrigosCogidos = true;

        // Añadir abrigo de Paxton al inventario
        // player.AddInventory(iAbrigoPaxton);

        oAbrigoPaxton.Visible = false;
        oAbrigoBarnes.Visible = false;

        cPaxton.Say("He guardado mi abrigo.");
        cBarnes.Say("Perfecto, ahora estamos listos para salir.");
    }
    else
    {
        cPaxton.Say("Ya tengo mi abrigo.");
    }
}

function hAbrigoBarnes_Interact()
{
    if (!bAbrigosCogidos)
    {
        bAbrigosCogidos = true;

        // Añadir abrigo de Barnes al inventario
        // player.AddInventory(iAbrigoBarnes);

        oAbrigoPaxton.Visible = false;
        oAbrigoBarnes.Visible = false;

        cBarnes.Say("He guardado mi abrigo.");
        cPaxton.Say("Perfecto, ahora estamos listos para salir.");
    }
    else
    {
        cBarnes.Say("Ya tengo mi abrigo.");
    }
}

function hAbrigoPaxton_MouseMove()
{
    Display("Abrigo de Paxton");
}

function hAbrigoBarnes_MouseMove()
{
    Display("Abrigo de Barnes");
}


// ==========================
// CUADROS (LookAt + MouseMove)
// ==========================
function hCuadro1_LookAt()
{
    cPaxton.Say("La inscripción dice “Horus caminando sobre el agua, 4000 a.C.”. Parece que el número “4” está resaltado con marcador rojo.");
    codigoDigito1 = 4; bCuadro1Examinado = true; VerificarPistas();
}
function hCuadro1_MouseMove() { Display("Cuadro egipcio"); }

function hCuadro4_LookAt()
{
    cPaxton.Say("La inscripción dice “Mita hacedor de milagros, 703 a.C.”. El número “7” está resaltado.");
    codigoDigito2 = 7; bCuadro4Examinado = true; VerificarPistas();
}
function hCuadro4_MouseMove() { Display("Cuadro romano"); }

function hCuadro2_LookAt()
{
    cPaxton.Say("La inscripción dice “Krishna, el hombre que salió del infierno después de morir, 1200 a.C.”. El número “2” está resaltado.");
    codigoDigito4 = 2; bCuadro2Examinado = true; VerificarPistas();
}
function hCuadro2_MouseMove() { Display("Cuadro hindú"); }

function hCuadro3_LookAt()
{
    cPaxton.Say("La inscripción dice “Los dioses griegos cenando en la mesa del Olimpo, 4000 a.C.”. El número “4” está resaltado.");
    codigoDigito3 = 4; bCuadro3Examinado = true; VerificarPistas();
}
function hCuadro3_MouseMove() { Display("Cuadro griego"); }

// ==========================
// LIBROS (LookAt + MouseMove)
// ==========================
function hLibro1_LookAt()
{
    cPaxton.Say("Libro antiguo, cuenta la historia de un mesías que caminaba sobre el agua, el libro fue escrito en el año 100 d.C.");
    bLibro1Examinado = true; VerificarPistas();
}
function hLibro1_MouseMove() { Display("Libro antiguo"); }

function hLibro2_LookAt()
{
    cPaxton.Say("Libro desgastado, cuenta sobre un mesías que cenaba con sus discípulos, el libro fue escrito en el año 300 d.C.");
    bLibro2Examinado = true; VerificarPistas();
}
function hLibro2_MouseMove() { Display("Libro desgastado"); }

function hLibro3_LookAt()
{
    cPaxton.Say("Libro sagrado descolorido, cuenta sobre un mesías que realizaba milagros por donde pasaba, el libro fue escrito en el año 200 d.C.");
    bLibro3Examinado = true; VerificarPistas();
}
function hLibro3_MouseMove() { Display("Libro sagrado"); }

function hLibro4_LookAt()
{
    cPaxton.Say("Libro sagrado contemporáneo, parece ser recién publicado. Cuenta sobre un mesías que salió del infierno tras morir.");
    bLibro4Examinado = true; VerificarPistas();
}
function hLibro4_MouseMove() { Display("Libro contemporáneo"); }

// ==========================
// DISCO DE VINILO (LookAt + Interact + MouseMove)
// ==========================
function hVinilo_LookAt()
{
    cPaxton.Say("Tiene una nota que dice “Reprodúceme”.");
}
function hVinilo_Interact()
{
    if (!bViniloCogido)
    {
        cPaxton.Say("Voy a guardar el disco en mi inventario.");
        bViniloCogido = true;
        // player.AddInventory(iVinilo);
        oVinilo.Visible = false;
    }
    else cPaxton.Say("Ya tengo el disco.");
}
function hVinilo_MouseMove() { Display("Disco de vinilo"); }

// ==========================
// TOCADISCOS
// ==========================

function hTocadiscos_LookAt()
{
    if (!bViniloColocado)
        cPaxton.Say("Mira, un tocadiscos, parece en buen estado.");
    else
        cPaxton.Say("El disco ya está reproduciéndose.");
}
// ==========================
// MENSAJE DEL DISCO
// ==========================
function MostrarMensajeDisco()
{
    Display("========================================");
    Display("SR. REED (V.O.):");
    Display("Hola, Barnes y Paxton. Si escuchan esto, ya son parte de mi pequeño experimento.");
    Display("Tienen que encontrar la contraseña de cuatro dígitos para abrir la puerta del sótano.");
    Display("Busquen entre las creencias del mundo… Todas son la misma mentira contada con distintos nombres.");
    Display("========================================");
}


function hTocadiscos_Interact()
{
    if (!bViniloCogido)
    {
        cPaxton.Say("Necesito primero el disco de vinilo para reproducirlo.");
        return;
    }

    if (!bViniloColocado)
    {
        cPaxton.Say("Voy a poner el disco...");
        bViniloColocado = true;

        // Ocultar tocadiscos sin disco
        oTocadiscosSin.Visible = false;
        // Mostrar tocadiscos con disco
        oTocadiscosCon.Visible = true;

        // Quitar el vinilo del inventario si lo tienes
        // player.LoseInventory(iVinilo);

        // Reproducir mensaje del disco
        MostrarMensajeDisco();
    }
    else
    {
        cPaxton.Say("El disco ya está reproduciéndose.");
    }
}

function hTocadiscos_MouseMove()
{
    Display("Tocadiscos antiguo");
}


// ==========================
// PUERTA DEL SÓTANO (Interact + MouseMove)
// ==========================
function hPuertaSotano_Interact()
{
    if (bPanelResuelto)
    {
        cPaxton.Say("La puerta está abierta. Bajemos.");
        player.ChangeRoom(3);
    }
    else cPaxton.Say("Está bloqueada. Necesito abrir el panel digital primero.");
}
function hPuertaSotano_MouseMove() { Display("Puerta vieja"); }
// ==========================
// TIJERAS
// ==========================

function hTijeras_LookAt()
{
    if (!bTijerasCogidas)
    {
        cBarnes.Say("Deberíamos de cogerlas, nunca está de más ser precavidos.");
    }
    else
    {
        cPaxton.Say("Ya las he cogido.");
    }
}

function hTijeras_Interact()
{
    if (!bTijerasCogidas)
    {
        bTijerasCogidas = true;

        // Añadir al inventario
        // player.AddInventory(iTijeras);

        oTijeras.Visible = false;  
        cBarnes.Say("Las guardamos por si acaso, a lo mejor son útiles luego");
    }
    else
    {
        cPaxton.Say("Ya tengo las tijeras.");
    }
}

function hTijeras_MouseMove()
{
    Display("Tijeras");
}


// ==========================
// ROOM AFTER FADE IN
// ==========================
function room_AfterFadeIn()
{
    if (primeraVezRoom2)
    {
        Wait(20);
        cPaxton.Say("Esta debe de ser la capilla del Sr. Reed...");
        cBarnes.Say("Mira todos esos libros.");
        cPaxton.Say("Y los cuadros... parecen de distintas religiones.");
        primeraVezRoom2 = false;
    }
}

function hPuertaSotano_OnClick(Hotspot *theHotspot, CursorMode mode)
{

}
