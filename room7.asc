// room script file

// Room 7 - CRÉDITOS

// Función auxiliar para verificar si un string contiene otro
bool StringContains(String texto, String buscar)
{
    if (texto == null) return false;
    if (buscar.Length > texto.Length) return false;

    for (int i = 0; i <= texto.Length - buscar.Length; i++)
    {
        bool encontrado = true;
        for (int j = 0; j < buscar.Length; j++)
        {
            if (texto.Chars[i + j] != buscar.Chars[j])
            {
                encontrado = false;
                break;
            }
        }
        if (encontrado) return true;
    }
    return false;
}

function room_Load()
{
    gGui1.Visible = false;
}

function room_Start()
{
    gGui1.Visible = false; 
}

function room_AfterFadeIn()
{
    gGui1.Visible = false;
    
    // Reproducir música de créditos
    aZambolino___Spiritus_in_Me__freetouse_com__credits.Play();

    // Variables de scroll
    int yPos = 480;
    int speed = 1;
    bool finished = false;
    int frames = 0;

    // Array de créditos
    String credits[60];
    for (int i = 0; i < 60; i++) credits[i] = "";

    // --- CONTENIDO ACTUALIZADO ---
    credits[0] = "CRÉDITOS";
    credits[2] = "MÚSICA";
    credits[4] = "Música Interiores";
    credits[5] = "por Andrés Mediavilla Rodríguez";
    
    // Camila Noir e info de Pixabay
    credits[7] = "Peaceful Nature Ambient – Tranquil Sounds";
    credits[8] = "por Camila Noir";
    credits[9] = "Fuente: Pixabay"; 

    credits[11] = "Castle";
    credits[12] = "por Walen";
    credits[13] = "Fuente: FreeToUse";
    credits[14] = "Música de fondo gratuita (No Copyright)";
    
    credits[16] = "Spiritus in Me";
    credits[17] = "por Zambolino";
    credits[18] = "Fuente: FreeToUse";
    credits[19] = "Música para videos (Descarga Gratuita)";
    
    credits[21] = "Dark atmosphere with rain";
    credits[22] = "por Milagros Gómez";
    credits[23] = "Fuente: Pixabay";

    credits[26] = "EFECTOS DE SONIDO";
    credits[28] = "Place Holder Assets";
    credits[29] = "por Mayra";
    
    credits[32] = "SPRITES";
    credits[34] = "Luis Carlos Rodríguez Pérez";
    credits[35] = "Jacob Gabriel Núñez Marapacuto";
    
    credits[38] = "FONDOS";
    credits[40] = "Jacob Gabriel Núñez Marapacuto";
    credits[41] = "Luis Carlos Rodríguez Pérez";
    credits[42] = "Ángela Yuqiang Leal Gorrachategui";
    
    credits[45] = "PROGRAMACIÓN";
    credits[47] = "Ángela Yuqiang Leal Gorrachategui";
    credits[48] = "Jiale Lin";
    credits[49] = "Andrés Mediavilla Rodríguez";
    credits[50] = "Izan Huesca Gordo";
    
    credits[53] = "Gracias por jugar";
    credits[55] = "Trabajo para Guión y Narración.";

    int totalCredits = 58; // Ajustado para incluir las últimas líneas

    DrawingSurface *bg = Room.GetDrawingSurfaceForBackground();

    while (!finished)
    {
        frames++;
        // Importante: Limpiar el frame anterior para evitar el rastro del texto
        bg.Clear(16); // Asumiendo que 16 es el color negro

        int currentY = yPos;

        for (int i = 0; i < totalCredits; i++)
        {
            if (credits[i] != null && credits[i] != "" && currentY > -30 && currentY < 510)
            {
                int textColor = 15; // Blanco por defecto
                
                if (credits[i] == "CRÉDITOS" || credits[i] == "Gracias por jugar") textColor = 14;
                else if (credits[i] == "MÚSICA" || credits[i] == "EFECTOS DE SONIDO" || 
                         credits[i] == "SPRITES" || credits[i] == "FONDOS" || 
                         credits[i] == "PROGRAMACIÓN") textColor = 13;
                else if (StringContains(credits[i], "por ")) textColor = 9;
                else if (StringContains(credits[i], "Fuente:")) textColor = 7;

                bg.DrawingColor = textColor;
                bg.DrawStringWrapped(70, currentY, 500, eFontFont3, eAlignCenter, credits[i]);
            }
            currentY += 28; // Espaciado entre líneas
        }

        // Parpadeo de mensaje ESC
        if (frames > 90 && (frames % 40) < 20)
        {
            bg.DrawingColor = 15;
            bg.DrawStringWrapped(440, 455, 190, eFontFont3, eAlignCenter, "ESC para saltar");
        }

        bg.Release();

        yPos -= speed;

        if (yPos < -1800 || IsKeyPressed(eKeyEscape) || IsKeyPressed(eKeySpace))
            finished = true;

        Wait(1);
        bg = Room.GetDrawingSurfaceForBackground();
    }

    FadeOut(10);
    player.ChangeRoom(5);
}
