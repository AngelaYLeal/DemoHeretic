
Overlay *olTypedText;

static void Typewriter::Type (int x, int y, int delay, int color, String text, 
                              TypewriterStyle style, AudioClip *sound) {
  
  int stringLength = text.Length;
  String displayedLine = "";
  
  olTypedText = Overlay.CreateTextual (x, y, 640- x, 
                                       3, color, displayedLine);
  
  Wait (delay);
  
  int i = 0;
  while (i < text.Length) {
    
    displayedLine = String.Format ("%s%c", displayedLine, text.Chars[i]);
    olTypedText.SetText (640- x, 3, color, displayedLine);
    
    if (style == eTypewriter_LongSpace) {
      if (text.Chars[i] == ' ')
        Wait(delay*2);
      else {
        if (sound)
          sound.Play ();
        Wait(delay);
      }
    }
    
    else if (style == eTypewriter_Constant) {
      if (text.Chars[i] == ' ')
        Wait(delay);
      else {
        if (sound)
          sound.Play ();
        Wait(delay);
      }
    }
    
    else if (style == eTypewriter_ShortSpace) {
      if (text.Chars[i] == ' ')
        Wait(delay/2);
      else {
        if (sound)
          sound.Play ();
        Wait(delay);
      }
    }
    
    else if (style == eTypeWriter_Mixed) {
      int r = Random(2);
      if (text.Chars[i] == ' ') {
        if (r == 0)
          Wait (delay*2);
        else if (r == 1)
          Wait (delay/2);
        else
          Wait (delay);
      }
      else {
        if (sound)
          sound.Play ();
        Wait (delay);
      }
    }
    
    i++;
 
  }
  
  SetTimer (2, TYPEWRITER_MAXIMUM_DISPLAY_TIME);
  
  Wait (TYPEWRITER_MAXIMUM_DISPLAY_TIME); //This is just an aesthetic addition, change/remove as you see fit.
  
}

static void Typewriter::Remove () {
  
  if (olTypedText.Valid)
    olTypedText.Remove ();
    
}

function repeatedly_execute() {
  
  if (IsTimerExpired(2)) {
    
    if (olTypedText.Valid)
      olTypedText.Remove ();
   
  }
  
}